<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - ServiciosPro</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-color: #667eea;
      --secondary-color: #764ba2;
      --success-color: #28a745;
      --error-color: #dc3545;
      --warning-color: #ffc107;
      --info-color: #17a2b8;
      --light-gray: #f8f9fa;
      --medium-gray: #6c757d;
      --dark-gray: #343a40;
      --border-color: #e9ecef;
      --shadow: 0 10px 30px rgba(0,0,0,0.1);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      display: flex;
      background: var(--light-gray);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
      color: white;
      display: flex;
      flex-direction: column;
      padding: 25px 0;
      box-shadow: var(--shadow);
      transition: var(--transition);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 1000;
    }

    .sidebar.mobile-hidden {
      transform: translateX(-100%);
    }

    .logo {
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 40px;
      padding: 0 20px;
      letter-spacing: -1px;
    }

    .user-info {
      background: rgba(255,255,255,0.1);
      padding: 15px 20px;
      margin: 0 15px 25px;
      border-radius: 12px;
      text-align: center;
    }

    .user-info .user-name {
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 5px;
    }

    .user-info .user-role {
      font-size: 13px;
      opacity: 0.9;
      background: rgba(255,255,255,0.2);
      padding: 4px 12px;
      border-radius: 12px;
      display: inline-block;
      margin-top: 5px;
    }

    .menu {
      display: flex;
      flex-direction: column;
      padding: 0 15px;
    }

    .menu-section {
      margin-bottom: 25px;
    }

    .menu-section-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      opacity: 0.7;
      margin-bottom: 10px;
      padding: 0 15px;
      font-weight: 600;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 15px;
      border-radius: 10px;
      cursor: pointer;
      transition: var(--transition);
      margin-bottom: 5px;
    }

    .menu-item:hover {
      background: rgba(255,255,255,0.15);
      transform: translateX(4px);
    }

    .menu-item.active {
      background: rgba(255,255,255,0.25);
      font-weight: 600;
    }

    .menu-item span {
      font-size: 15px;
      font-weight: 500;
    }

    .menu-item .icon {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }

    /* Mobile Menu Toggle */
    .mobile-menu-toggle {
      display: none;
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1001;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      border: none;
      width: 45px;
      height: 45px;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: var(--shadow);
      font-size: 20px;
    }

    .mobile-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }

    .mobile-overlay.active {
      display: block;
    }

    /* Main Container */
    .main-container {
      flex: 1;
      margin-left: 280px;
      display: flex;
      flex-direction: column;
      transition: var(--transition);
    }

    /* Header */
    .header {
      background: white;
      padding: 20px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .header-title h1 {
      font-size: 24px;
      font-weight: 700;
      color: var(--dark-gray);
    }

    .logout-btn {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      font-size: 14px;
    }

    .logout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    /* Main content */
    .main-content {
      flex: 1;
      padding: 30px;
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Alert Cards */
    .alert-card {
      background: white;
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      border-left: 5px solid;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .alert-card.warning {
      border-left-color: var(--warning-color);
      background: linear-gradient(to right, rgba(255, 193, 7, 0.05), white);
    }

    .alert-card.info {
      border-left-color: var(--info-color);
      background: linear-gradient(to right, rgba(23, 162, 184, 0.05), white);
    }

    .alert-card.success {
      border-left-color: var(--success-color);
      background: linear-gradient(to right, rgba(40, 167, 69, 0.05), white);
    }

    .alert-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
    }

    .alert-icon {
      font-size: 28px;
    }

    .alert-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--dark-gray);
      flex: 1;
    }

    .alert-body {
      margin-bottom: 15px;
      color: var(--medium-gray);
      line-height: 1.6;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border-color);
      border-radius: 10px;
      overflow: hidden;
      margin: 15px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      transition: width 1s ease-out;
      border-radius: 10px;
    }

    .progress-text {
      font-size: 13px;
      color: var(--medium-gray);
      margin-top: 8px;
    }

    .action-button {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      font-size: 14px;
      margin-top: 10px;
    }

    .action-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }

    .action-button.outline {
      background: white;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
    }

    /* Card */
    .card {
      background: white;
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      transition: var(--transition);
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(102,126,234,0.15);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--border-color);
    }

    .card-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--dark-gray);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-body {
      color: var(--medium-gray);
      line-height: 1.6;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 50px 20px;
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .empty-state-text {
      color: var(--medium-gray);
      font-size: 16px;
      margin-bottom: 20px;
    }

    /* Solicitudes */
    .solicitud-item {
      background: var(--light-gray);
      padding: 18px;
      border-radius: 12px;
      margin-bottom: 12px;
      border-left: 4px solid var(--primary-color);
      transition: var(--transition);
    }

    .solicitud-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .solicitud-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 10px;
    }

    .solicitud-title {
      font-weight: 600;
      color: var(--dark-gray);
      margin-bottom: 8px;
    }

    .solicitud-meta {
      font-size: 13px;
      color: var(--medium-gray);
    }

    .status-badge {
      padding: 5px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-pendiente {
      background: rgba(255, 193, 7, 0.15);
      color: #856404;
    }

    .status-aceptada {
      background: rgba(23, 162, 184, 0.15);
      color: #0c5460;
    }

    .status-completada {
      background: rgba(40, 167, 69, 0.15);
      color: #155724;
    }

    .status-rechazada, .status-cancelada {
      background: rgba(220, 53, 69, 0.15);
      color: #721c24;
    }

    /* Grid Layout */
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .mobile-menu-toggle {
        display: block;
      }

      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.mobile-visible {
        transform: translateX(0);
      }

      .main-container {
        margin-left: 0;
      }

      .header {
        padding: 15px 20px 15px 75px;
      }

      .header-title h1 {
        font-size: 20px;
      }

      .main-content {
        padding: 20px 15px;
      }

      .card, .alert-card {
        padding: 20px 15px;
      }
    }

    @media (max-width: 480px) {
      .logout-btn {
        padding: 8px 16px;
        font-size: 13px;
      }

      .action-button {
        width: 100%;
        margin-top: 15px;
      }

      .solicitud-header {
        flex-direction: column;
        gap: 10px;
      }
    }

    /* Hide scrollbar but keep functionality */
    .sidebar::-webkit-scrollbar {
      width: 6px;
    }

    .sidebar::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.3);
      border-radius: 3px;
    }
  </style>
</head>
<body>
  <!-- Mobile Menu Toggle -->
  <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">‚ò∞</button>

  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="mobileOverlay" onclick="toggleMobileMenu()"></div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="logo">üîß ServiciosPro</div>
    
    <!-- User Info -->
    <div class="user-info">
      <div class="user-name" id="userName">Usuario</div>
      <div class="user-role" id="userRole">Cargando...</div>
    </div>

    <!-- Menu -->
    <nav class="menu" id="mainMenu">
      <!-- Secci√≥n Principal -->
	  <div class="menu-section">
	    <div class="menu-section-title">Principal</div>
	    <div class="menu-item active" onclick="navigateTo('inicio', event)">
	      <span class="icon">üè†</span>
	      <span>Inicio</span>
	    </div>
	  </div>
	
	  <!-- Secci√≥n Usuario -->
	  <div class="menu-section menu-usuario-section">
	    <div class="menu-section-title">Informaci√≥n Personal</div>
	    <div class="menu-item" onclick="goToInformacionPersonal()">
	      <span class="icon">üë§</span>
	      <span>Actualizar mis Datos</span>
	    </div>
	  </div>
	
	  <!-- Secci√≥n Cliente -->
	  <div class="menu-section menu-cliente-section" style="display: none;">
	    <div class="menu-section-title">Como Cliente</div>
	    <div class="menu-item" onclick="navigateTo('mis-solicitudes', event)">
	      <span class="icon">üìã</span>
	      <span>Mis Solicitudes</span>
	    </div>
	    <div class="menu-item" onclick="goToBuscarProfesional()">
	      <span class="icon">üîç</span>
	      <span>Buscar Profesionales</span>
	    </div>
	    <div class="menu-item" onclick="goToActualizarCliente()">
	      <span class="icon">üë§</span>
	      <span>Mi Perfil Cliente</span>
	    </div>
	  </div>
	
	  <!-- Secci√≥n Profesional -->
	  <div class="menu-section menu-profesional-section" style="display: none;">
	    <div class="menu-section-title">Como Profesional</div>
	    <div class="menu-item" onclick="navigateTo('mis-trabajos', event)">
	      <span class="icon">üíº</span>
	      <span>Mis Trabajos</span>
	    </div>
	    <div class="menu-item" onclick="goToMisServicios()">
	      <span class="icon">‚öôÔ∏è</span>
	      <span>Servicios Ofrecidos</span>
	    </div>
	    <div class="menu-item" onclick="goToActualizarProfesional()">
	      <span class="icon">üîß</span>
	      <span>Mi Perfil Profesional</span>
	    </div>
	  </div>
	
	  <!-- Secci√≥n Estad√≠sticas -->
	  <div class="menu-section">
	    <div class="menu-section-title">Reportes</div>
	    <div class="menu-item" onclick="navigateTo('estadisticas', event)">
	      <span class="icon">üìä</span>
	      <span>Estad√≠sticas</span>
	    </div>
	  </div>
    </nav>
  </aside>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Header -->
    <header class="header">
      <div class="header-title">
        <h1 id="pageTitle">Dashboard</h1>
      </div>
      <button class="logout-btn" onclick="logout()">
        Cerrar Sesi√≥n
      </button>
    </header>

    <!-- Main Content -->
    <main class="main-content" id="contentArea">
      <!-- El contenido se cargar√° din√°micamente aqu√≠ -->
    </main>
  </div>

  <script>
    // ============================================
    // VARIABLES GLOBALES
    // ============================================
    let userData = {};
    let currentView = 'inicio';

    // ============================================
    // INICIALIZACI√ìN
    // ============================================
    document.addEventListener('DOMContentLoaded', async () => {
      // Cargar datos del usuario
      userData = JSON.parse(localStorage.getItem('userData') || '{}');
      
      if (!userData.id) {
        alert('Sesi√≥n no v√°lida. Por favor inicie sesi√≥n nuevamente.');
        window.location.href = 'login.html';
        return;
      }

      // Configurar UI seg√∫n usuario
      setupUserInterface();
      
      // Cargar vista inicial
      await navigateTo('inicio');
    });

    // ============================================
    // CONFIGURACI√ìN DE INTERFAZ
    // ============================================
    function setupUserInterface() {
      // Mostrar nombre del usuario
      const nombreMostrar = userData.nombreCompleto || userData.nombre || 'Usuario';
      document.getElementById('userName').textContent = nombreMostrar;

      // Detectar y mostrar rol
      const tipoRol = userData.tipoRol || userData.tipo || 'CLIENTE';
      const esCliente = userData.esCliente !== undefined ? userData.esCliente :
                       (tipoRol === 'CLIENTE' || tipoRol === 'AMBOS');
      const esProfesional = userData.esProfesional !== undefined ? userData.esProfesional :
                           (tipoRol === 'PROFESIONAL' || tipoRol === 'AMBOS');

      // Actualizar badge de rol
      let rolTexto = '';
      if (tipoRol === 'AMBOS') {
        rolTexto = 'üë• Cliente & Profesional';
      } else if (esProfesional) {
        rolTexto = 'üîß Profesional';
      } else {
        rolTexto = 'üë§ Cliente';
      }
      document.getElementById('userRole').textContent = rolTexto;

      // Mostrar/ocultar secciones del men√∫ seg√∫n rol
      document.querySelectorAll('.menu-cliente-section').forEach(el => {
        el.style.display = esCliente ? 'block' : 'none';
      });
      
      document.querySelectorAll('.menu-profesional-section').forEach(el => {
        el.style.display = esProfesional ? 'block' : 'none';
      });

      console.log('Usuario configurado:', { tipoRol, esCliente, esProfesional });
    }

    // ============================================
    // NAVEGACI√ìN
    // ============================================
    async function navigateTo(view, clickEvent) {
	  currentView = view;
	  
	  // Actualizar items activos del men√∫
	  document.querySelectorAll('.menu-item').forEach(item => {
	    item.classList.remove('active');
	  });
	  
	  // Si hay un evento de click, marcar el item como activo
	  if (clickEvent && clickEvent.target) {
	    const menuItem = clickEvent.target.closest('.menu-item');
	    if (menuItem) {
	      menuItem.classList.add('active');
	    }
	  } else {
	    // Si no hay evento (llamada program√°tica), buscar el item por el onclick
	    const menuItems = document.querySelectorAll('.menu-item');
	    menuItems.forEach(item => {
	      const onclickAttr = item.getAttribute('onclick');
	      if (onclickAttr && onclickAttr.includes(`'${view}'`)) {
	        item.classList.add('active');
	      }
	    });
	  }
	
	  // Cerrar men√∫ m√≥vil si est√° abierto
	  closeMobileMenu();
	
	  // Cargar vista
	  const contentArea = document.getElementById('contentArea');
	  
	  switch(view) {
	    case 'inicio':
	      document.getElementById('pageTitle').textContent = 'Dashboard';
	      await renderInicio(contentArea);
	      break;
	    case 'mis-solicitudes':
	      document.getElementById('pageTitle').textContent = 'Mis Solicitudes';
	      await renderMisSolicitudes(contentArea);
	      break;
	    case 'mis-trabajos':
	      document.getElementById('pageTitle').textContent = 'Mis Trabajos';
	      await renderMisTrabajos(contentArea);
	      break;
	    case 'estadisticas':
	      document.getElementById('pageTitle').textContent = 'Estad√≠sticas';
	      renderEstadisticas(contentArea);
	      break;
	    default:
	      renderInicio(contentArea);
	  }
	}

    // ============================================
    // VISTA: INICIO
    // ============================================
    async function renderInicio(container) {
      const tipoRol = userData.tipoRol || userData.tipo || 'CLIENTE';
      const esCliente = userData.esCliente !== undefined ? userData.esCliente :
                       (tipoRol === 'CLIENTE' || tipoRol === 'AMBOS');
      const esProfesional = userData.esProfesional !== undefined ? userData.esProfesional :
                           (tipoRol === 'PROFESIONAL' || tipoRol === 'AMBOS');

      let html = '';

      // Avisos de completitud de perfil
      html += await generarAvisosCompletitud(esCliente, esProfesional);

      // Avisos de invitaci√≥n a registrarse en otro rol
      if (tipoRol !== 'AMBOS') {
        if (esCliente && !esProfesional) {
          html += generarAvisoRegistroProfesional();
        } else if (esProfesional && !esCliente) {
          html += generarAvisoRegistroCliente();
        }
      }

      // Contenido seg√∫n rol
      html += '<div class="grid-2">';
      
      if (esCliente) {
        html += await generarSeccionSolicitudesRecientes();
      }
      
      if (esProfesional) {
        html += await generarSeccionTrabajosRecientes();
      }
      
      html += '</div>';

      // Si no tiene ning√∫n rol (caso edge), mostrar mensaje
      if (!esCliente && !esProfesional) {
        html = `
          <div class="empty-state">
            <div class="empty-state-icon">‚ö†Ô∏è</div>
            <div class="empty-state-text">
              No se pudo determinar tu rol en el sistema.<br>
              Por favor contacta al administrador.
            </div>
          </div>
        `;
      }

      container.innerHTML = html;
    }

    // ============================================
    // GENERACI√ìN DE AVISOS
    // ============================================
    async function generarAvisosCompletitud(esCliente, esProfesional) {
      let html = '';

      if (esCliente) {
        const porcentajeCliente = await calcularCompletitudCliente();
        if (porcentajeCliente < 100) {
          html += `
            <div class="alert-card warning">
              <div class="alert-header">
                <div class="alert-icon">‚ö†Ô∏è</div>
                <div class="alert-title">Completa tu perfil de Cliente</div>
              </div>
              <div class="alert-body">
                Tu perfil est√° al <strong>${porcentajeCliente}%</strong>. 
                Completa tu informaci√≥n para mejorar tu experiencia y recibir mejores servicios.
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${porcentajeCliente}%"></div>
              </div>
              <div class="progress-text">${porcentajeCliente}% completado</div>
              <button class="action-button" onclick="goToActualizarCliente()">
                Completar Perfil de Cliente
              </button>
            </div>
          `;
        } else {
          html += `
            <div class="alert-card success">
              <div class="alert-header">
                <div class="alert-icon">‚úÖ</div>
                <div class="alert-title">Perfil de Cliente Completo</div>
              </div>
              <div class="alert-body">
                ¬°Excelente! Tu perfil de cliente est√° completo al 100%.
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: 100%"></div>
              </div>
            </div>
          `;
        }
      }

      if (esProfesional) {
        const porcentajeProfesional = await calcularCompletitudProfesional();
        if (porcentajeProfesional < 100) {
          html += `
            <div class="alert-card warning">
              <div class="alert-header">
                <div class="alert-icon">üîß</div>
                <div class="alert-title">Completa tu perfil Profesional</div>
              </div>
              <div class="alert-body">
                Tu perfil profesional est√° al <strong>${porcentajeProfesional}%</strong>. 
                Completa tu informaci√≥n para recibir m√°s solicitudes de servicio.
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${porcentajeProfesional}%"></div>
              </div>
              <div class="progress-text">${porcentajeProfesional}% completado</div>
              <button class="action-button" onclick="goToActualizarProfesional()">
                Completar Perfil Profesional
              </button>
            </div>
          `;
        } else {
          html += `
            <div class="alert-card success">
              <div class="alert-header">
                <div class="alert-icon">‚úÖ</div>
                <div class="alert-title">Perfil Profesional Completo</div>
              </div>
              <div class="alert-body">
                ¬°Excelente! Tu perfil profesional est√° completo al 100%.
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: 100%"></div>
              </div>
            </div>
          `;
        }
      }

      return html;
    }

    function generarAvisoRegistroProfesional() {
      return `
        <div class="alert-card info">
          <div class="alert-header">
            <div class="alert-icon">üíº</div>
            <div class="alert-title">¬øEres un profesional?</div>
          </div>
          <div class="alert-body">
            Reg√≠strate como profesional y comienza a ofrecer tus servicios. 
            Accede a nuevas oportunidades de trabajo y aumenta tus ingresos.
          </div>
          <button class="action-button" onclick="registrarseComoProfesional()">
            Registrarme como Profesional
          </button>
        </div>
      `;
    }

    function generarAvisoRegistroCliente() {
      return `
        <div class="alert-card info">
          <div class="alert-header">
            <div class="alert-icon">üë§</div>
            <div class="alert-title">¬øNecesitas servicios?</div>
          </div>
          <div class="alert-body">
            Reg√≠strate tambi√©n como cliente para poder solicitar servicios profesionales. 
            Encuentra expertos para cualquier trabajo que necesites.
          </div>
          <button class="action-button" onclick="registrarseComoCliente()">
            Registrarme como Cliente
          </button>
        </div>
      `;
    }

    // ============================================
    // C√ÅLCULO DE COMPLETITUD DE PERFILES
    // ============================================
    async function calcularCompletitudCliente() {
      // TODO: Implementar llamada al API para obtener datos completos del cliente
      // Por ahora, retornamos un c√°lculo b√°sico
      
      let completitud = 0;
      let camposTotal = 10; // Campos importantes del perfil
      let camposCompletos = 0;

      // Verificar datos b√°sicos
      if (userData.nombreCompleto) camposCompletos++;
      if (userData.email) camposCompletos++;
      if (userData.telefono) camposCompletos++;
      if (userData.numeroDocumento) camposCompletos++;
      if (userData.tipoDocumento) camposCompletos++;
      if (userData.fechaNacimiento) camposCompletos++;
      if (userData.genero) camposCompletos++;
      if (userData.direccion) camposCompletos++;
      if (userData.departamentoId) camposCompletos++;
      if (userData.distritoId) camposCompletos++;

      completitud = Math.round((camposCompletos / camposTotal) * 100);
      return completitud;
    }

    async function calcularCompletitudProfesional() {
      // TODO: Implementar llamada al API para obtener datos del profesional
      // Por ahora, retornamos un c√°lculo simulado
      
      let completitud = 0;
      let camposTotal = 8;
      let camposCompletos = 0;

      // Verificar datos b√°sicos (estos deber√≠an venir del API)
      if (userData.descripcion) camposCompletos++;
      if (userData.experiencia) camposCompletos++;
      if (userData.especialidadId) camposCompletos++;
      if (userData.habilidades && userData.habilidades.length > 0) camposCompletos++;
      if (userData.certificaciones && userData.certificaciones.length > 0) camposCompletos++;
      if (userData.fotoPerfil) camposCompletos++;
      if (userData.fotoPortada) camposCompletos++;
      if (userData.tarifaHora) camposCompletos++;

      // Si no tenemos estos datos, asumir 50% por defecto
      if (camposCompletos === 0) {
        return 50;
      }

      completitud = Math.round((camposCompletos / camposTotal) * 100);
      return completitud;
    }

    // ============================================
    // SECCI√ìN: SOLICITUDES RECIENTES
    // ============================================
    async function generarSeccionSolicitudesRecientes() {
      try {
        const response = await fetch(`./api/solicitudes?tipo=cliente&usuarioId=${userData.id}`);
        const data = await response.json();

        if (!data.success || !data.data.solicitudes) {
          return generarSeccionVacia('solicitudes');
        }

        const solicitudes = data.data.solicitudes.slice(0, 5);

        if (solicitudes.length === 0) {
          return generarSeccionVacia('solicitudes');
        }

        let html = `
          <div class="card">
            <div class="card-header">
              <div class="card-title">üìã Mis Solicitudes Recientes</div>
              <button class="action-button outline" onclick="navigateTo('mis-solicitudes')">
                Ver Todas
              </button>
            </div>
            <div class="card-body">
        `;

        solicitudes.forEach(solicitud => {
          html += generarItemSolicitud(solicitud);
        });

        html += `
            </div>
          </div>
        `;

        return html;
      } catch (error) {
        console.error('Error al cargar solicitudes:', error);
        return generarSeccionVacia('solicitudes');
      }
    }

    function generarItemSolicitud(solicitud) {
      const estado = solicitud.estado || 'pendiente';
      const estadoClass = `status-${estado}`;
      const estadoTexto = {
        'pendiente': 'Pendiente',
        'aceptada': 'Aceptada',
        'completada': 'Completada',
        'rechazada': 'Rechazada',
        'cancelada': 'Cancelada'
      };

      const fecha = new Date(solicitud.fechaSolicitud).toLocaleDateString('es-PE', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });

      return `
        <div class="solicitud-item">
          <div class="solicitud-header">
            <div>
              <div class="solicitud-title">
                ${solicitud.descripcion?.substring(0, 60) || 'Sin descripci√≥n'}${solicitud.descripcion?.length > 60 ? '...' : ''}
              </div>
              <div class="solicitud-meta">
                üìÖ ${fecha} ‚Ä¢ üí∞ S/ ${solicitud.presupuestoEstimado?.toFixed(2) || '0.00'}
              </div>
            </div>
            <span class="status-badge ${estadoClass}">
              ${estadoTexto[estado]}
            </span>
          </div>
        </div>
      `;
    }

    // ============================================
    // SECCI√ìN: TRABAJOS RECIENTES
    // ============================================
    async function generarSeccionTrabajosRecientes() {
      // TODO: Implementar llamada al API para obtener trabajos del profesional
      return `
        <div class="card">
          <div class="card-header">
            <div class="card-title">üíº Mis Trabajos Recientes</div>
            <button class="action-button outline" onclick="navigateTo('mis-trabajos')">
              Ver Todos
            </button>
          </div>
          <div class="card-body">
            <div class="empty-state">
              <div class="empty-state-icon">üì≠</div>
              <div class="empty-state-text">
                No tienes trabajos asignados a√∫n
              </div>
              <button class="action-button" onclick="goToMisServicios()">
                Configurar Mis Servicios
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function generarSeccionVacia(tipo) {
      if (tipo === 'solicitudes') {
        return `
          <div class="card">
            <div class="card-header">
              <div class="card-title">üìã Mis Solicitudes Recientes</div>
            </div>
            <div class="card-body">
              <div class="empty-state">
                <div class="empty-state-icon">üì≠</div>
                <div class="empty-state-text">
                  No tienes solicitudes a√∫n
                </div>
                <button class="action-button" onclick="goToBuscarProfesional()">
                  üîç Buscar Profesionales
                </button>
              </div>
            </div>
          </div>
        `;
      }
      return '';
    }

    // ============================================
    // VISTA: MIS SOLICITUDES
    // ============================================
    async function renderMisSolicitudes(container) {
      try {
        const response = await fetch(`./api/solicitudes?tipo=cliente&usuarioId=${userData.id}`);
        const data = await response.json();

        if (!data.success || !data.data.solicitudes) {
          container.innerHTML = generarSeccionVacia('solicitudes');
          return;
        }

        const solicitudes = data.data.solicitudes;

        if (solicitudes.length === 0) {
          container.innerHTML = generarSeccionVacia('solicitudes');
          return;
        }

        let html = `
          <div class="card">
            <div class="card-header">
              <div class="card-title">üìã Todas mis Solicitudes</div>
              <button class="action-button" onclick="goToBuscarProfesional()">
                Nueva Solicitud
              </button>
            </div>
            <div class="card-body">
        `;

        solicitudes.forEach(solicitud => {
          html += generarItemSolicitud(solicitud);
        });

        html += `
            </div>
          </div>
        `;

        container.innerHTML = html;
      } catch (error) {
        console.error('Error al cargar solicitudes:', error);
        container.innerHTML = `
          <div class="card">
            <div class="card-body">
              <div class="empty-state">
                <div class="empty-state-icon">‚ö†Ô∏è</div>
                <div class="empty-state-text">
                  Error al cargar solicitudes
                </div>
              </div>
            </div>
          </div>
        `;
      }
    }

    // ============================================
    // VISTA: MIS TRABAJOS
    // ============================================
    async function renderMisTrabajos(container) {
      // TODO: Implementar API para obtener trabajos del profesional
      container.innerHTML = `
        <div class="card">
          <div class="card-header">
            <div class="card-title">üíº Mis Trabajos Asignados</div>
          </div>
          <div class="card-body">
            <div class="empty-state">
              <div class="empty-state-icon">üì≠</div>
              <div class="empty-state-text">
                No tienes trabajos asignados en este momento
              </div>
              <button class="action-button" onclick="goToMisServicios()">
                Configurar Mis Servicios
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // ============================================
    // VISTA: ESTAD√çSTICAS
    // ============================================
    function renderEstadisticas(container) {
      container.innerHTML = `
        <div class="card">
          <div class="card-header">
            <div class="card-title">üìä Estad√≠sticas y M√©tricas</div>
          </div>
          <div class="card-body">
            <canvas id="servicesChart" width="400" height="200"></canvas>
          </div>
        </div>
      `;

      // Renderizar gr√°fico
      setTimeout(() => {
        const ctx = document.getElementById('servicesChart');
        if (ctx) {
          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio'],
              datasets: [
                {
                  label: 'Solicitudes',
                  data: [12, 19, 7, 14, 20, 15],
                  backgroundColor: 'rgba(102, 126, 234, 0.6)',
                  borderColor: '#667eea',
                  borderWidth: 2
                },
                {
                  label: 'Completadas',
                  data: [8, 15, 6, 11, 18, 12],
                  backgroundColor: 'rgba(40, 167, 69, 0.6)',
                  borderColor: '#28a745',
                  borderWidth: 2
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: { beginAtZero: true }
              }
            }
          });
        }
      }, 100);
    }

    // ============================================
    // FUNCIONES DE NAVEGACI√ìN EXTERNA
    // ============================================
    
    function goToInformacionPersonal() {
	  window.location.href = "informacion-personal.html";
	}
    
    function goToActualizarCliente() {
      window.location.href = "perfil-cliente.html";
    }

    function goToActualizarProfesional() {
      const usuarioId = userData.id;
      window.location.href = `profesional.html?usuarioId=${usuarioId}`;
    }

    function goToBuscarProfesional() {
      window.location.href = "buscar-profesional.html";
    }

    function goToMisServicios() {
      window.location.href = "servicios-profesional.html";
    }

    function registrarseComoProfesional() {
      const usuarioId = userData.id;
      // Redirigir a la p√°gina de registro profesional
      window.location.href = `profesional.html?usuarioId=${usuarioId}&modo=nuevo`;
    }

    function registrarseComoCliente() {
      // Redirigir a la p√°gina de registro cliente
      window.location.href = "perfil-cliente.html?modo=nuevo";
    }

    // ============================================
    // MEN√ö M√ìVIL
    // ============================================
    function toggleMobileMenu() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('mobileOverlay');
      
      sidebar.classList.toggle('mobile-visible');
      overlay.classList.toggle('active');
    }

    function closeMobileMenu() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('mobileOverlay');
      
      sidebar.classList.remove('mobile-visible');
      overlay.classList.remove('active');
    }

    // ============================================
    // LOGOUT
    // ============================================
    function logout() {
      if (confirm('¬øEst√°s seguro que deseas cerrar sesi√≥n?')) {
        localStorage.clear();
        window.location.href = "login.html";
      }
    }
  </script>
</body>
</html>