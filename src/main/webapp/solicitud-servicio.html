<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitar Servicio - ServiciosPro</title>
    <link rel="stylesheet" href="assets/css/solicitud-servicio.css">
</head>
<body>
    <div class="container">
        <div class="header">
		    <div class="header-content">
		        <!-- Botones de navegaci√≥n -->
		        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
		            <button type="button" class="btn-nav-back" onclick="volverBusqueda()">
		                üîç Cambiar Profesional
		            </button>
		            <button type="button" class="btn-nav-dashboard" onclick="volverDashboard()">
		                üè† Volver al Dashboard
		            </button>
		        </div>
		
		        <h1>üìã Solicitar Servicio</h1>
		        <p>Completa los detalles de tu solicitud</p>
		        
		        <div class="provider-info" id="providerInfo">
		            <div class="provider-avatar">üë®‚Äçüîß</div>
		            <div class="provider-details">
		                <h3 id="providerName">Cargando...</h3>
		                <div class="provider-rating" id="providerRating"></div>
		            </div>
		        </div>
		    </div>
		</div>

        <div class="form-content">
            <div id="alertContainer"></div>

            <!-- Progress Steps -->
            <div class="progress-steps">
                <div class="progress-line" id="progressLine" style="width: 0%"></div>
                <div class="step active" data-step="1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Descripci√≥n</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Ubicaci√≥n</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Fecha y Hora</div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-circle">4</div>
                    <div class="step-label">Confirmar</div>
                </div>
            </div>

            <form id="serviceRequestForm" novalidate>
                <!-- Step 1: Descripci√≥n del Servicio -->
                <div class="form-step active" data-step="1">
                    <div class="form-section">
                        <h3 class="section-title">üìù Descripci√≥n del Trabajo</h3>
                        
                        <div class="form-group">
                            <label class="form-label">
                                ¬øQu√© trabajo necesitas?
                                <span class="required">*</span>
                                <span class="hint">(M√≠nimo 20 caracteres)</span>
                            </label>
                            <textarea 
                                class="form-textarea" 
                                id="description" 
                                name="description" 
                                placeholder="Describe detalladamente el trabajo que necesitas..."
                                required
                                minlength="20"
                                maxlength="1000"
                            ></textarea>
                            <div class="char-counter" id="descCounter">0/1000 caracteres (m√≠nimo 20)</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Presupuesto Estimado
                                <span class="required">*</span>
                            </label>
                            <div class="budget-input-wrapper">
                                <span class="currency-symbol">S/</span>
                                <input 
                                    type="number" 
                                    class="form-input budget-input" 
                                    id="budget" 
                                    name="budget" 
                                    placeholder="150"
                                    min="20"
                                    step="10"
                                    required
                                >
                            </div>
                            <div style="font-size: 12px; color: var(--medium-gray); margin-top: 5px;">
                                Este es un presupuesto referencial. El proveedor puede ajustarlo seg√∫n la evaluaci√≥n del trabajo.
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Fotos del √Årea de Trabajo (Opcional)
                                <span class="hint">(M√°ximo 3 fotos, 5MB cada una)</span>
                            </label>
                            <div class="photo-upload-area" id="photoUploadArea">
                                <div class="photo-slot" onclick="selectPhoto(0)">
                                    <div class="upload-icon">üì∑</div>
                                    <div class="upload-text">Foto 1</div>
                                    <input type="file" accept="image/*" style="display: none;" onchange="previewPhoto(this, 0)">
                                    <button type="button" class="remove-photo-btn" onclick="removePhoto(event, 0)">√ó</button>
                                </div>
                                <div class="photo-slot" onclick="selectPhoto(1)">
                                    <div class="upload-icon">üì∑</div>
                                    <div class="upload-text">Foto 2</div>
                                    <input type="file" accept="image/*" style="display: none;" onchange="previewPhoto(this, 1)">
                                    <button type="button" class="remove-photo-btn" onclick="removePhoto(event, 1)">√ó</button>
                                </div>
                                <div class="photo-slot" onclick="selectPhoto(2)">
                                    <div class="upload-icon">üì∑</div>
                                    <div class="upload-text">Foto 3</div>
                                    <input type="file" accept="image/*" style="display: none;" onchange="previewPhoto(this, 2)">
                                    <button type="button" class="remove-photo-btn" onclick="removePhoto(event, 2)">√ó</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Ubicaci√≥n y Modalidad - REFACTORIZADO EN MIGRACI√ìN V008 -->
                <div class="form-step" data-step="2">
                    <div class="form-section">
                        <h3 class="section-title">üìç Ubicaci√≥n del Servicio</h3>

                        <!-- NUEVO: Selector de Modalidad de Trabajo -->
                        <div class="form-group">
                            <label class="form-label">
                                Modalidad de Trabajo
                                <span class="required">*</span>
                            </label>
                            <p class="form-hint">Selecciona c√≥mo deseas que se realice el servicio</p>

                            <div class="modalidad-selector">
                                <!-- Opci√≥n: Trabajo Remoto -->
                                <div class="modalidad-option" id="modalidadRemotoOption" style="display: none;">
                                    <input type="radio"
                                           id="modalidadRemoto"
                                           name="modalidad"
                                           value="REMOTO"
                                           onchange="handleModalidadChange('REMOTO')">
                                    <label for="modalidadRemoto" class="modalidad-label">
                                        <div class="modalidad-icon">üíª</div>
                                        <div class="modalidad-text">
                                            <strong>Trabajo Remoto</strong>
                                            <span>El servicio se realiza de forma virtual</span>
                                        </div>
                                    </label>
                                </div>

                                <!-- Opci√≥n: Trabajo Presencial -->
                                <div class="modalidad-option" id="modalidadPresencialOption" style="display: none;">
                                    <input type="radio"
                                           id="modalidadPresencial"
                                           name="modalidad"
                                           value="PRESENCIAL"
                                           onchange="handleModalidadChange('PRESENCIAL')">
                                    <label for="modalidadPresencial" class="modalidad-label">
                                        <div class="modalidad-icon">üè†</div>
                                        <div class="modalidad-text">
                                            <strong>Trabajo Presencial</strong>
                                            <span>El servicio se realiza en tu domicilio</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <!-- Mensaje de carga -->
                            <div id="modalidadCargando" class="alert alert-info">
                                ‚è≥ Cargando modalidades disponibles...
                            </div>

                            <!-- Mensaje de error -->
                            <div id="modalidadError" class="alert alert-error" style="display: none;">
                                ‚ö†Ô∏è No se pudieron cargar las modalidades disponibles.
                            </div>
                        </div>

                        <!-- NUEVO: Formulario de Direcci√≥n Presencial (oculto por defecto) -->
                        <div id="direccionPresencialForm" style="display: none;">
                            <h4 class="subsection-title">üìÆ Direcci√≥n del Servicio</h4>

                            <!-- NUEVO: Ubicaci√≥n Geogr√°fica - Cascada Departamento ‚Üí Provincia ‚Üí Distrito -->
                            <div class="datetime-grid">
                                <div class="form-group">
                                    <label class="form-label">
                                        Departamento
                                        <span class="required">*</span>
                                    </label>
                                    <select class="form-select" id="departamento" name="departamento" required>
                                        <option value="">Seleccione departamento</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">
                                        Provincia
                                        <span class="required">*</span>
                                    </label>
                                    <select class="form-select" id="provincia" name="provincia" required disabled>
                                        <option value="">Seleccione provincia</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">
                                        Distrito
                                        <span class="required">*</span>
                                    </label>
                                    <select class="form-select" id="distrito" name="distrito" required disabled>
                                        <option value="">Seleccione distrito</option>
                                    </select>
                                </div>
                            </div>

                            <!-- MODIFICADO: Direcci√≥n Exacta (calle, n√∫mero, etc.) -->
                            <div class="form-group">
                                <label class="form-label">
                                    Direcci√≥n Exacta
                                    <span class="required">*</span>
                                </label>
                                <input type="text"
                                       class="form-input"
                                       id="direccion"
                                       name="direccion"
                                       placeholder="Ej: Av. Larco 1234, Edificio Azul, Dpto 501"
                                       required>
                                <p class="form-hint">Ingresa calle, n√∫mero, edificio, departamento, etc.</p>
                            </div>

                            <!-- MODIFICADO: C√≥digo Postal y Referencias -->
                            <div class="datetime-grid">
                                <div class="form-group">
                                    <label class="form-label">C√≥digo Postal</label>
                                    <input type="text"
                                           class="form-input"
                                           id="codigoPostal"
                                           name="codigoPostal"
                                           placeholder="Ej: 15074">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Referencias</label>
                                    <input type="text"
                                           class="form-input"
                                           id="referencia"
                                           name="referencia"
                                           placeholder="Ej: Cerca al parque Kennedy">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Fecha y Hora -->
                <div class="form-step" data-step="3">
                    <div class="form-section">
                        <h3 class="section-title">üìÖ Fecha y Hora Preferida</h3>
                        
                        <div class="datetime-grid">
                            <div class="form-group">
                                <label class="form-label">
                                    Fecha Preferida
                                    <span class="required">*</span>
                                </label>
                                <input 
                                    type="date" 
                                    class="form-input" 
                                    id="serviceDate" 
                                    name="serviceDate" 
                                    required
                                >
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    Hora Preferida
                                    <span class="required">*</span>
                                </label>
                                <input 
                                    type="time" 
                                    class="form-input" 
                                    id="serviceTime" 
                                    name="serviceTime" 
                                    required
                                >
                            </div>
                        </div>

                        <div style="background: rgba(23, 162, 184, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 13px; color: #0c5460;">
                            ‚ÑπÔ∏è La fecha y hora son referenciales. El proveedor puede sugerir ajustes seg√∫n su disponibilidad.
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">‚ö° Urgencia del Servicio</h3>
                        
                        <div class="urgency-selector">
                            <div class="urgency-option selected" onclick="selectUrgency(this, 'normal')">
                                <div class="urgency-icon">üïê</div>
                                <div class="urgency-title">Normal</div>
                                <div class="urgency-description">
                                    Respuesta esperada en 24-48 horas
                                </div>
                            </div>
                            
                            <div class="urgency-option" onclick="selectUrgency(this, 'urgent')">
                                <div class="urgency-icon">‚ö°</div>
                                <div class="urgency-title">Urgente</div>
                                <div class="urgency-description">
                                    Necesito atenci√≥n lo antes posible
                                </div>
                            </div>
                        </div>
                        
                        <input type="hidden" id="urgency" name="urgency" value="normal">
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">üí¨ Informaci√≥n Adicional (Opcional)</h3>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Comentarios o instrucciones especiales
                            </label>
                            <textarea 
                                class="form-textarea" 
                                id="additionalNotes" 
                                name="additionalNotes" 
                                placeholder="Ej: Por favor tocar el timbre 3 veces..."
                                maxlength="500"
                                style="min-height: 80px;"
                            ></textarea>
                            <div class="char-counter" id="notesCounter">0/500 caracteres</div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Confirmar Solicitud -->
                <div class="form-step" data-step="4">
                    <div class="form-section">
                        <h3 class="section-title">‚úÖ Resumen de la Solicitud</h3>
                        
                        <div class="summary-section">
                            <div class="summary-item">
                                <div class="summary-label">Proveedor:</div>
                                <div class="summary-value" id="summaryProvider">-</div>
                            </div>
                            
                            <div class="summary-item">
                                <div class="summary-label">Descripci√≥n del trabajo:</div>
                                <div class="summary-value" id="summaryDescription">-</div>
                            </div>
                            
                            <div class="summary-item">
                                <div class="summary-label">Ubicaci√≥n:</div>
                                <div class="summary-value" id="summaryLocation">-</div>
                            </div>
                            
                            <div class="summary-item">
                                <div class="summary-label">Fecha y hora:</div>
                                <div class="summary-value" id="summaryDateTime">-</div>
                            </div>
                            
                            <div class="summary-item">
                                <div class="summary-label">Presupuesto estimado:</div>
                                <div class="summary-value" id="summaryBudget">-</div>
                            </div>
                            
                            <div class="summary-item">
                                <div class="summary-label">Urgencia:</div>
                                <div class="summary-value" id="summaryUrgency">-</div>
                            </div>
                            
                            <div class="summary-item" id="summaryPhotosContainer" style="display: none;">
                                <div class="summary-label">Fotos adjuntas:</div>
                                <div class="summary-value">
                                    <div class="summary-photos" id="summaryPhotos"></div>
                                </div>
                            </div>
                            
                            <div class="summary-item" id="summaryNotesContainer" style="display: none;">
                                <div class="summary-label">Notas adicionales:</div>
                                <div class="summary-value" id="summaryNotes">-</div>
                            </div>
                        </div>

                        <div style="background: rgba(255, 193, 7, 0.1); padding: 20px; border-radius: 12px; border: 2px solid rgba(255, 193, 7, 0.3); margin-top: 20px;">
                            <h4 style="color: #856404; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                ‚ÑπÔ∏è Informaci√≥n Importante
                            </h4>
                            <ul style="color: #856404; font-size: 13px; line-height: 1.8; padding-left: 20px;">
                                <li>El proveedor recibir√° tu solicitud inmediatamente</li>
                                <li>Tiene hasta <strong>48 horas</strong> para responder</li>
                                <li>Recibir√°s una notificaci√≥n cuando responda</li>
                                <li>Puedes cancelar la solicitud si est√° en estado "Pendiente"</li>
                            </ul>
                        </div>

                        <div class="form-group" style="margin-top: 25px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="terms" name="terms" required style="width: 18px; height: 18px;">
                                <span style="font-size: 14px;">
                                    Acepto los <a href="#" style="color: var(--primary-color);">t√©rminos y condiciones</a> 
                                    del servicio
                                </span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Success Screen -->
                <div class="form-step" data-step="5">
                    <div class="success-animation">
                        <div class="success-icon">‚úÖ</div>
                        <h2 class="success-title">¬°Solicitud Enviada con √âxito!</h2>
                        <p class="success-message">
                            Tu solicitud ha sido enviada al proveedor. Te notificaremos cuando responda.
                        </p>
                        
                        <div style="background: var(--light-gray); padding: 20px; border-radius: 12px; margin: 25px 0;">
                            <div style="font-size: 14px; color: var(--medium-gray); margin-bottom: 10px;">
                                C√≥digo de Solicitud:
                            </div>
                            <div class="request-id" id="requestId">SR-2024-000000</div>
                            <div style="font-size: 13px; color: var(--medium-gray); margin-top: 15px;">
                                üìß Hemos enviado los detalles a tu correo electr√≥nico<br>
                                üì± Recibir√°s notificaciones sobre el estado de tu solicitud
                            </div>
                        </div>

                        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-secondary" onclick="goToRequests()">
                                üìã Ver Mis Solicitudes
                            </button>
                            <button type="button" class="btn btn-primary" onclick="goHome()">
                                üè† Ir al Inicio
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="form-navigation" id="formNavigation">
                    <button type="button" class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">
                        ‚Üê Anterior
                    </button>
                    <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                        Siguiente ‚Üí
                    </button>
                    <button type="submit" class="btn btn-primary" id="submitBtn" style="display: none;">
                        <span class="spinner"></span>
                        <span class="button-text">üì§ Enviar Solicitud</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- API de Ubicaci√≥n -->
    <script src="assets/js/ubicacion-api.js"></script>

    <script src="assets/js/solicitud-servicio.js"></script>
</body>
</html>