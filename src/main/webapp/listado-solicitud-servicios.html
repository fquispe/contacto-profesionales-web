<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Solicitudes - ServiciosPro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --primary-dark: #5a6fd8;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --error-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-gray: #f8f9fa;
            --medium-gray: #6c757d;
            --dark-gray: #343a40;
            --border-color: #e9ecef;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --shadow-hover: 0 8px 30px rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: white;
            border-radius: 20px 20px 0 0;
            box-shadow: var(--shadow);
            padding: 30px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 32px;
            color: var(--dark-gray);
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            color: var(--medium-gray);
        }

        .btn-back {
            padding: 10px 20px;
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-back:hover {
            background: var(--primary-color);
            color: white;
            transform: translateX(-3px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        /* Filters Section */
        .filters-section {
            background: white;
            padding: 20px 30px;
            box-shadow: var(--shadow);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            font-weight: 500;
            color: var(--dark-gray);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .filter-input,
        .filter-select {
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .filter-input:focus,
        .filter-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-filter {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-filter:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        /* Stats Cards */
        .stats-section {
            background: white;
            padding: 20px 30px;
            box-shadow: var(--shadow);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.15);
        }

        .stat-icon {
            font-size: 36px;
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-info h3 {
            font-size: 28px;
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-info p {
            font-size: 13px;
            color: var(--medium-gray);
            font-weight: 500;
        }

        /* Content Section */
        .content-section {
            background: white;
            padding: 30px;
            box-shadow: var(--shadow);
            min-height: 400px;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .content-title {
            font-size: 20px;
            color: var(--dark-gray);
            font-weight: 600;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
        }

        .view-btn {
            padding: 8px 15px;
            border: 2px solid var(--border-color);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--light-gray);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Solicitudes Grid */
        .solicitudes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .solicitud-card {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .solicitud-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--primary-color);
            transition: all 0.3s ease;
        }

        .solicitud-card.pendiente::before {
            background: var(--warning-color);
        }

        .solicitud-card.aceptada::before {
            background: var(--info-color);
        }

        .solicitud-card.completada::before {
            background: var(--success-color);
        }

        .solicitud-card.rechazada::before,
        .solicitud-card.cancelada::before {
            background: var(--error-color);
        }

        .solicitud-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .card-codigo {
            font-family: monospace;
            font-size: 14px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .card-estado {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .estado-pendiente {
            background: rgba(255, 193, 7, 0.15);
            color: #856404;
        }

        .estado-aceptada {
            background: rgba(23, 162, 184, 0.15);
            color: #0c5460;
        }

        .estado-completada {
            background: rgba(40, 167, 69, 0.15);
            color: #155724;
        }

        .estado-rechazada,
        .estado-cancelada {
            background: rgba(220, 53, 69, 0.15);
            color: #721c24;
        }

        .card-profesional {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: var(--light-gray);
            border-radius: 8px;
        }

        .profesional-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .profesional-info h4 {
            font-size: 14px;
            color: var(--dark-gray);
            font-weight: 600;
            margin-bottom: 2px;
        }

        .profesional-info p {
            font-size: 12px;
            color: var(--medium-gray);
        }

        .card-description {
            font-size: 14px;
            color: var(--medium-gray);
            line-height: 1.6;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .detail-item {
            font-size: 13px;
        }

        .detail-label {
            color: var(--medium-gray);
            font-weight: 500;
            display: block;
            margin-bottom: 3px;
        }

        .detail-value {
            color: var(--dark-gray);
            font-weight: 600;
        }

        .card-footer {
            display: flex;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .btn-card {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-ver {
            background: var(--light-gray);
            color: var(--dark-gray);
        }

        .btn-ver:hover {
            background: var(--border-color);
        }

        .btn-cancelar {
            background: var(--error-color);
            color: white;
        }

        .btn-cancelar:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-cancelar:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 24px;
            color: var(--dark-gray);
            margin-bottom: 10px;
        }

        .empty-state p {
            font-size: 16px;
            color: var(--medium-gray);
            margin-bottom: 20px;
        }

        .btn-new-request {
            padding: 12px 25px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-new-request:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        /* Footer */
        .footer {
            background: white;
            border-radius: 0 0 20px 20px;
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
        }

        /* Alert Messages */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        .alert.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .solicitudes-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .filters-grid {
                grid-template-columns: 1fr;
            }

            .solicitudes-grid {
                grid-template-columns: 1fr;
            }

            .stats-section {
                grid-template-columns: 1fr;
            }

            .content-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <button class="btn-back" onclick="volverDashboard()">
                    ‚Üê Volver al Dashboard
                </button>
                <div style="flex: 1; text-align: center;">
                    <h1>üìã Mis Solicitudes de Servicio</h1>
                    <p>Gestiona y revisa todas tus solicitudes</p>
                </div>
                <div style="width: 180px;"></div>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="filters-section">
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">Estado</label>
                    <select id="filterEstado" class="filter-select">
                        <option value="">Todos los estados</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="aceptada">Aceptada</option>
                        <option value="completada">Completada</option>
                        <option value="rechazada">Rechazada</option>
                        <option value="cancelada">Cancelada</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Ordenar por</label>
                    <select id="filterOrden" class="filter-select">
                        <option value="reciente">M√°s reciente</option>
                        <option value="antiguo">M√°s antiguo</option>
                        <option value="presupuesto">Presupuesto</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Buscar</label>
                    <input type="text" id="filterBusqueda" class="filter-input" placeholder="Buscar por descripci√≥n...">
                </div>

                <button class="btn-filter" onclick="aplicarFiltros()">
                    üîç Filtrar
                </button>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-icon">üìù</div>
                <div class="stat-info">
                    <h3 id="totalSolicitudes">0</h3>
                    <p>Total Solicitudes</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">‚è≥</div>
                <div class="stat-info">
                    <h3 id="pendientes">0</h3>
                    <p>Pendientes</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-info">
                    <h3 id="completadas">0</h3>
                    <p>Completadas</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-info">
                    <h3 id="presupuestoTotal">S/ 0</h3>
                    <p>Presupuesto Total</p>
                </div>
            </div>
        </div>

        <!-- Alert Container -->
        <div id="alertContainer"></div>

        <!-- Content Section -->
        <div class="content-section">
            <div class="content-header">
                <div class="content-title" id="resultadosInfo">Cargando solicitudes...</div>
                <button class="btn-new-request" onclick="nuevaSolicitud()">
                    ‚ûï Nueva Solicitud
                </button>
            </div>

            <!-- Loading State -->
            <div class="loading" id="loadingState" style="display: block;">
                <div class="loading-spinner"></div>
                <p>Cargando tus solicitudes...</p>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-icon">üì≠</div>
                <h3>No tienes solicitudes a√∫n</h3>
                <p>Comienza buscando profesionales y solicita servicios</p>
                <button class="btn-new-request" onclick="nuevaSolicitud()">
                    üîç Buscar Profesionales
                </button>
            </div>

            <!-- Solicitudes Grid -->
            <div class="solicitudes-grid" id="solicitudesGrid"></div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>&copy; 2025 ServiciosPro - Gesti√≥n de Solicitudes</p>
        </div>
    </div>

    <script>
        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        const API_BASE_URL = './api';
        let todasLasSolicitudes = [];
        let solicitudesFiltradas = [];
        let usuarioId = null;

        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Iniciando listado de solicitudes...');

            // Verificar autenticaci√≥n
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            usuarioId = userData.id;

            if (!usuarioId) {
                showAlert('Debes iniciar sesi√≥n para ver tus solicitudes', 'error');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return;
            }

            console.log('Usuario autenticado:', usuarioId);
            cargarSolicitudes();
        });

        // ============================================
        // CARGAR SOLICITUDES
        // ============================================
        async function cargarSolicitudes() {
            showLoading();

            try {
                
            	// üî• Obtener userData del localStorage
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                const usuarioId = userData.id;
                
                if (!usuarioId) {
                    showAlert('Error: Usuario no autenticado', 'error');
                    setTimeout(() => window.location.href = 'login.html', 2000);
                    return;
                }
                
             	// üî• Enviar usuarioId como par√°metro
                const url = `${API_BASE_URL}/solicitudes?tipo=cliente&usuarioId=${usuarioId}`;
                console.log('Cargando solicitudes desde:', url);

                const response = await fetch(url);
                const data = await response.json();

                console.log('Respuesta del servidor:', data);

                if (data.success) {
                    todasLasSolicitudes = data.data.solicitudes || [];
                    solicitudesFiltradas = [...todasLasSolicitudes];

                    console.log('Solicitudes cargadas:', todasLasSolicitudes.length);

                    actualizarEstadisticas();
                    mostrarSolicitudes();
                } else {
                    throw new Error(data.error || 'Error al cargar solicitudes');
                }
            } catch (error) {
                console.error('Error al cargar solicitudes:', error);
                showAlert('Error al cargar las solicitudes: ' + error.message, 'error');
                hideLoading();
                showEmptyState();
            }
        }

        // ============================================
        // MOSTRAR SOLICITUDES
        // ============================================
        function mostrarSolicitudes() {
            hideLoading();
            const grid = document.getElementById('solicitudesGrid');
            const resultadosInfo = document.getElementById('resultadosInfo');

            if (solicitudesFiltradas.length === 0) {
                grid.innerHTML = '';
                resultadosInfo.textContent = 'No se encontraron solicitudes';
                showEmptyState();
                return;
            }

            hideEmptyState();
            resultadosInfo.textContent = `${solicitudesFiltradas.length} solicitud(es) encontrada(s)`;

            grid.innerHTML = '';
            solicitudesFiltradas.forEach(solicitud => {
                grid.appendChild(crearTarjetaSolicitud(solicitud));
            });
        }

        // ============================================
        // CREAR TARJETA DE SOLICITUD
        // ============================================
        function crearTarjetaSolicitud(solicitud) {
            const card = document.createElement('div');
            card.className = `solicitud-card ${solicitud.estado}`;

            const codigo = generarCodigoSolicitud(solicitud.id);
            const fecha = formatearFecha(solicitud.fechaSolicitud);
            const fechaServicio = formatearFecha(solicitud.fechaServicio);
            const urgencia = solicitud.urgencia === 'urgent' ? '‚ö° Urgente' : 'üïê Normal';

            card.innerHTML = `
                <div class="card-header">
                    <div class="card-codigo">${codigo}</div>
                    <span class="card-estado estado-${solicitud.estado}">
                        ${traducirEstado(solicitud.estado)}
                    </span>
                </div>

                <div class="card-profesional">
                    <div class="profesional-avatar">üë®‚Äçüîß</div>
                    <div class="profesional-info">
                        <h4>Profesional ID: ${solicitud.profesionalId}</h4>
                        <p>${urgencia}</p>
                    </div>
                </div>

                <div class="card-description">
                    ${solicitud.descripcion || 'Sin descripci√≥n'}
                </div>

                <div class="card-details">
                    <div class="detail-item">
                        <span class="detail-label">üìÖ Fecha Solicitada:</span>
                        <span class="detail-value">${fechaServicio}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">üí∞ Presupuesto:</span>
                        <span class="detail-value">S/ ${solicitud.presupuestoEstimado?.toFixed(2) || '0.00'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">üìç Distrito:</span>
                        <span class="detail-value">${solicitud.distrito || 'N/A'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">üìÜ Registrada:</span>
                        <span class="detail-value">${fecha}</span>
                    </div>
                </div>

                <div class="card-footer">
                    <button class="btn-card btn-ver" onclick="verDetalle(${solicitud.id})">
                        üëÅÔ∏è Ver Detalles
                    </button>
                    ${solicitud.estado === 'pendiente' ? `
                    <button class="btn-card btn-cancelar" onclick="cancelarSolicitud(${solicitud.id})">
                        ‚ùå Cancelar
                    </button>
                    ` : ''}
                </div>
            `;

            return card;
        }

        // ============================================
        // ACTUALIZAR ESTAD√çSTICAS
        // ============================================
        function actualizarEstadisticas() {
            const total = todasLasSolicitudes.length;
            const pendientes = todasLasSolicitudes.filter(s => s.estado === 'pendiente').length;
            const completadas = todasLasSolicitudes.filter(s => s.estado === 'completada').length;
            const presupuestoTotal = todasLasSolicitudes.reduce((sum, s) => sum + (s.presupuestoEstimado || 0), 0);

            document.getElementById('totalSolicitudes').textContent = total;
            document.getElementById('pendientes').textContent = pendientes;
            document.getElementById('completadas').textContent = completadas;
            document.getElementById('presupuestoTotal').textContent = `S/ ${presupuestoTotal.toFixed(2)}`;
        }

        // ============================================
        // FILTRAR SOLICITUDES
        // ============================================
        function aplicarFiltros() {
            const estado = document.getElementById('filterEstado').value;
            const orden = document.getElementById('filterOrden').value;
            const busqueda = document.getElementById('filterBusqueda').value.toLowerCase();

            solicitudesFiltradas = [...todasLasSolicitudes];

            // Filtrar por estado
            if (estado) {
                solicitudesFiltradas = solicitudesFiltradas.filter(s => s.estado === estado);
            }

            // Filtrar por b√∫squeda
            if (busqueda) {
                solicitudesFiltradas = solicitudesFiltradas.filter(s =>
                    s.descripcion?.toLowerCase().includes(busqueda) ||
                    s.distrito?.toLowerCase().includes(busqueda)
                );
            }

            // Ordenar
            if (orden === 'reciente') {
                solicitudesFiltradas.sort((a, b) => new Date(b.fechaSolicitud) - new Date(a.fechaSolicitud));
            } else if (orden === 'antiguo') {
                solicitudesFiltradas.sort((a, b) => new Date(a.fechaSolicitud) - new Date(b.fechaSolicitud));
            } else if (orden === 'presupuesto') {
                solicitudesFiltradas.sort((a, b) => b.presupuestoEstimado - a.presupuestoEstimado);
            }

            mostrarSolicitudes();
        }

        // ============================================
        // ACCIONES
        // ============================================
        function verDetalle(id) {
            // Implementar vista detallada de la solicitud
            console.log('Ver detalle de solicitud:', id);
            showAlert('Funcionalidad en desarrollo', 'info');
        }

        async function cancelarSolicitud(id) {
            if (!confirm('¬øEst√°s seguro que deseas cancelar esta solicitud?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/solicitudes/${id}/cancelar`, {
                    method: 'PUT'
                });

                const data = await response.json();

                if (data.success) {
                    showAlert('Solicitud cancelada exitosamente', 'success');
                    cargarSolicitudes();
                } else {
                    throw new Error(data.error || 'Error al cancelar');
                }
            } catch (error) {
                console.error('Error al cancelar solicitud:', error);
                showAlert('Error al cancelar la solicitud: ' + error.message, 'error');
            }
        }

        function nuevaSolicitud() {
            window.location.href = 'buscar-profesional.html';
        }

        function volverDashboard() {
            window.location.href = 'dashboard.html';
        }

        // ============================================
        // UTILIDADES
        // ============================================
        function generarCodigoSolicitud(id) {
            const year = new Date().getFullYear();
            return `SR-${year}-${String(id).padStart(6, '0')}`;
        }

        function formatearFecha(fecha) {
            if (!fecha) return 'N/A';
            const date = new Date(fecha);
            return date.toLocaleDateString('es-PE', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function traducirEstado(estado) {
            const estados = {
                'pendiente': 'Pendiente',
                'aceptada': 'Aceptada',
                'completada': 'Completada',
                'rechazada': 'Rechazada',
                'cancelada': 'Cancelada'
            };
            return estados[estado] || estado;
        }

        // ============================================
        // UI STATE FUNCTIONS
        // ============================================
        function showLoading() {
            document.getElementById('loadingState').style.display = 'block';
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('solicitudesGrid').innerHTML = '';
        }

        function hideLoading() {
            document.getElementById('loadingState').style.display = 'none';
        }

        function showEmptyState() {
            document.getElementById('emptyState').style.display = 'block';
            document.getElementById('solicitudesGrid').innerHTML = '';
        }

        function hideEmptyState() {
            document.getElementById('emptyState').style.display = 'none';
        }

        function showAlert(message, type = 'info') {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} show`;
            alert.textContent = message;

            container.innerHTML = '';
            container.appendChild(alert);

            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => alert.remove(), 300);
            }, 5000);
        }
    </script>
</body>
</html>
